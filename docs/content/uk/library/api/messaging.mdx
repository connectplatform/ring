---
title: API –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
description: –ü–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API —Å–∏—Å—Ç–µ–º–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ Ring —É —Ä–µ–∂–∏–º—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é WebSocket, —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è–º —Ä–æ–∑–º–æ–≤–∞–º–∏ —Ç–∞ –≤–∫–ª–∞–¥–µ–Ω–Ω—è–º–∏ —Ñ–∞–π–ª—ñ–≤
last_modified: "2025-10-16"
---

import { Callout } from '@/components/docs/callout'
import { Steps, Step } from '@/components/docs/steps'

# API –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ Ring –Ω–∞–¥–∞—î –∫–æ–º–ø–ª–µ–∫—Å–Ω—É —Å–∏—Å—Ç–µ–º—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É —Ä–µ–∂–∏–º—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É —ñ–∑ **8 REST –∫—ñ–Ω—Ü–µ–≤–∏–º–∏ —Ç–æ—á–∫–∞–º–∏** —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é WebSocket. –°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ä–æ–∑–º–æ–≤–∏, –ø—Ä—è–º—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –≤–∫–ª–∞–¥–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤, —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ –Ω–∞–±–æ—Ä—É —Ç–µ–∫—Å—Ç—É, —Ç–∞ –∫–≤–∏—Ç–∞–Ω—Ü—ñ—ó –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—è –∑ –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—é –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è.

<Callout type="info" title="‚ö° –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É">
–ü–æ–±—É–¥–æ–≤–∞–Ω–æ –Ω–∞ **Tunnel Transport** –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º —Ñ–æ–ª–±–µ–∫–æ–º: WebSocket ‚Üí SSE ‚Üí Long-polling –¥–ª—è —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ—ó —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ —É –≤—Å—ñ—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è.
</Callout>

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

```
–î—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Üí –ö—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ API ‚Üí –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É –ë–î ‚Üí –¢—Ä–∞–Ω—Å–ª—è—Ü—ñ—è —É —Ä–µ–∂–∏–º—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É ‚Üí –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI
                                      ‚Üì
                            –í–∫–ª–∞–¥–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ (—è–∫—â–æ —î) ‚Üí –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É CDN
```

### –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏–π —à–∞—Ä —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó

- **WebSocket (–ü–µ—Ä–≤–∏–Ω–Ω–∏–π)**: –ë—ñ–Ω–∞—Ä–Ω–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è —É —Ä–µ–∂–∏–º—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É
- **Server-Sent Events (SSE)**: –§–æ–ª–±–µ–∫ –¥–ª—è Vercel Edge Runtime
- **Long-polling**: –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Ñ–æ–ª–±–µ–∫ –¥–ª—è –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â
- **HTTP REST**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó —ñ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É

### –°—Ç—Ä–∞—Ç–µ–≥—ñ—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è

- **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**: PostgreSQL —ñ–∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏ JSONB —Ç–∞ –ø–æ–≤–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–∏–º –ø–æ—à—É–∫–æ–º
- **–§–∞–π–ª–∏**: CDN —Å—Ö–æ–≤–∏—â–µ (Cloudflare R2, AWS S3 –∞–±–æ —Å—É–º—ñ—Å–Ω–µ)
- **–°—Ç–∞–Ω —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É**: Redis pub/sub –¥–ª—è –º—ñ–∂–µ–∫–∑–µ–º–ø–ª—è—Ä–Ω–æ—ó –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó
- **–ß–µ—Ä–≥–∞ –æ—Ñ–ª–∞–π–Ω**: IndexedDB –¥–ª—è —á–µ—Ä–≥–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –æ—Ñ–ª–∞–π–Ω

## üìã –î–æ–≤—ñ–¥–∫–∞ –∫—ñ–Ω—Ü–µ–≤–∏—Ö —Ç–æ—á–æ–∫ API

### `GET /api/conversations`

–°–ø–∏—Å–æ–∫ —Ä–æ–∑–º–æ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —ñ–∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–º —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞–Ω–Ω—è–º —Ç–∞ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±–æ–≤'—è–∑–∫–æ–≤–∏–π | –û–ø–∏—Å |
|-----------|-----|--------------|------|
| `page` | number | –ù—ñ | –ù–æ–º–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 1) |
| `limit` | number | –ù—ñ | –†–æ–∑–º–æ–≤ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 20, –º–∞–∫—Å: 50) |
| `type` | string | –ù—ñ | –§—ñ–ª—å—Ç—Ä –∑–∞ —Ç–∏–ø–æ–º: `direct`, `group`, `channel` |
| `status` | string | –ù—ñ | –§—ñ–ª—å—Ç—Ä –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º: `active`, `archived`, `muted` |
| `before` | string | –ù—ñ | ISO –¥–∞—Ç–∞ - —Ä–æ–∑–º–æ–≤–∏ –æ–Ω–æ–≤–ª–µ–Ω—ñ –¥–æ —Ü—ñ—î—ó –¥–∞—Ç–∏ |
| `search` | string | –ù—ñ | –ü–æ—à—É–∫ –∑–∞ —ñ–º–µ–Ω–∞–º–∏ —É—á–∞—Å–Ω–∏–∫—ñ–≤ –∞–±–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ |

#### –ü—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Ç—É

<Code language="bash" title="curl -X GET "http://localhost:3000/api/conversations?page=1&limit=10&type=direct&status=active" \">
{`-H "Authorization: Bearer your-session-token"`}
</Code>

#### –í—ñ–¥–ø–æ–≤—ñ–¥—å

<Code language="json" title="{">
{`"conversations": [
    {
      "id": "conv_123456",
      "type": "direct",
      "participants": [
        {
          "userId": "user_789",
          "name": "John Doe",
          "avatar": "https://...",
          "role": "member",
          "lastSeen": "2025-10-16T12:30:00Z"
        }
      ],
      "title": null,
      "description": null,
      "lastMessage": {
        "id": "msg_999999",
        "content": "–ü—Ä–∏–≤—ñ—Ç, —è–∫ –ø—Ä–æ—Å—É–≤–∞—î—Ç—å—Å—è –ø—Ä–æ–µ–∫—Ç?",
        "senderId": "user_789",
        "timestamp": "2025-10-16T12:30:00Z",
        "type": "text"
      },
      "unreadCount": 2,
      "updatedAt": "2025-10-16T12:30:00Z",
      "createdAt": "2025-10-15T09:00:00Z",
      "settings": {
        "muted": false,
        "pinned": false,
        "notifications": true
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 25,
    "totalPages": 3,
    "hasNext": true,
    "hasPrev": false
  }
}`}
</Code>

### `POST /api/conversations`

–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É —Ä–æ–∑–º–æ–≤—É (–ø—Ä—è–º–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–±–æ –≥—Ä—É–ø–æ–≤–∏–π —á–∞—Ç).

#### –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

<Code language="json" title="{">
{`"type": "direct",
  "participantIds": ["user_456"],
  "initialMessage": {
    "content": "–ü—Ä–∏–≤—ñ—Ç! –Ø —Ö–æ—á—É –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å.",
    "type": "text"
  }
}`}
</Code>

#### –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É –¥–ª—è –≥—Ä—É–ø–æ–≤–æ—ó —Ä–æ–∑–º–æ–≤–∏

<Code language="json" title="{">
{`"type": "group",
  "title": "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç—É Alpha",
  "description": "–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è —Ä–æ–∑—Ä–æ–±–∫–∏ –ø—Ä–æ–µ–∫—Ç—É Alpha",
  "participantIds": ["user_456", "user_789", "user_101"],
  "settings": {
    "isPrivate": true,
    "allowInvites": true,
    "moderationEnabled": false
  }
}`}
</Code>

#### –í—ñ–¥–ø–æ–≤—ñ–¥—å

<Code language="json" title="{">
{`"conversation": {
    "id": "conv_123457",
    "type": "direct",
    "participants": [
      {
        "userId": "user_123",
        "name": "–ü–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á",
        "role": "admin"
      },
      {
        "userId": "user_456",
        "name": "Jane Smith",
        "role": "member"
      }
    ],
    "title": null,
    "createdAt": "2025-10-16T12:35:00Z",
    "settings": {
      "muted": false,
      "pinned": false,
      "notifications": true
    }
  },
  "initialMessage": {
    "id": "msg_100000",
    "conversationId": "conv_123457",
    "senderId": "user_123",
    "content": "–ü—Ä–∏–≤—ñ—Ç! –Ø —Ö–æ—á—É –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å.",
    "type": "text",
    "timestamp": "2025-10-16T12:35:00Z",
    "status": "sent"
  }
}`}
</Code>

### `GET /api/conversations/{id}/messages`

–û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Ä–æ–∑–º–æ–≤–∏ –∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±–æ–≤'—è–∑–∫–æ–≤–∏–π | –û–ø–∏—Å |
|-----------|-----|--------------|------|
| `page` | number | –ù—ñ | –ù–æ–º–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 1) |
| `limit` | number | –ù—ñ | –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 50, –º–∞–∫—Å: 100) |
| `before` | string | –ù—ñ | ISO –¥–∞—Ç–∞ - –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ —Ü—å–æ–≥–æ —á–∞—Å—É |
| `after` | string | –ù—ñ | ISO –¥–∞—Ç–∞ - –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ —á–∞—Å—É |
| `type` | string | –ù—ñ | –§—ñ–ª—å—Ç—Ä –∑–∞ —Ç–∏–ø–æ–º: `text`, `file`, `image`, `system` |

#### –ü—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Ç—É

<Code language="bash" title="curl -X GET "http://localhost:3000/api/conversations/conv_123456/messages?page=1&limit=25" \">
{`-H "Authorization: Bearer your-session-token"`}
</Code>

#### –í—ñ–¥–ø–æ–≤—ñ–¥—å

<Code language="json" title="{">
{`"messages": [
    {
      "id": "msg_100001",
      "conversationId": "conv_123456",
      "senderId": "user_456",
      "content": "–î—è–∫—É—é –∑–∞ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è! –ü—Ä–æ–µ–∫—Ç –ø—Ä–æ—Å—É–≤–∞—î—Ç—å—Å—è –¥–æ–±—Ä–µ.",
      "type": "text",
      "timestamp": "2025-10-16T12:36:00Z",
      "status": "delivered",
      "readBy": ["user_123"],
      "reactions": [],
      "replyTo": null,
      "edited": false,
      "attachments": []
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 25,
    "total": 47,
    "totalPages": 2,
    "hasNext": true,
    "hasPrev": false
  },
  "conversation": {
    "id": "conv_123456",
    "type": "direct",
    "participants": ["user_123", "user_456"]
  }
}`}
</Code>

### `POST /api/conversations/{id}/messages`

–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ —Ä–æ–∑–º–æ–≤–∏.

#### –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

<Code language="json" title="{">
{`"content": "–û—Å—å –¥–æ–∫—É–º–µ–Ω—Ç, —è–∫–∏–π –≤–∏ –ø—Ä–æ—Å–∏–ª–∏.",
  "type": "text",
  "replyTo": null
}`}
</Code>

#### –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É –∑ –≤–∫–ª–∞–¥–µ–Ω–Ω—è–º —Ñ–∞–π–ª—É

<Code language="json" title="{">
{`"content": "–ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü–µ–π –¥–æ–∫—É–º–µ–Ω—Ç",
  "type": "text",
  "attachments": [
    {
      "name": "requirements.pdf",
      "type": "application/pdf",
      "size": 2048576,
      "url": "https://cdn.example.com/files/requirements.pdf"
    }
  ]
}`}
</Code>

#### –í—ñ–¥–ø–æ–≤—ñ–¥—å

<Code language="json" title="{">
{`"message": {
    "id": "msg_100003",
    "conversationId": "conv_123456",
    "senderId": "user_123",
    "content": "–ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü–µ–π –¥–æ–∫—É–º–µ–Ω—Ç",
    "type": "text",
    "timestamp": "2025-10-16T12:38:00Z",
    "status": "sent",
    "readBy": [],
    "reactions": [],
    "replyTo": null,
    "edited": false,
    "attachments": [
      {
        "id": "att_123456",
        "name": "requirements.pdf",
        "type": "application/pdf",
        "size": 2048576,
        "url": "https://cdn.example.com/files/att_123456.pdf",
        "thumbnailUrl": null
      }
    ]
  },
  "delivered": true,
  "realTimeSent": true
}`}
</Code>

### `PUT /api/messages/{id}`

–û–Ω–æ–≤–∏—Ç–∏/—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–æ–º, —É –º–µ–∂–∞—Ö —á–∞—Å—É).

#### –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É

<Code language="json" title="{">
{`"content": "–ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü–µ–π –æ–Ω–æ–≤–ª–µ–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç",
  "attachments": []
}`}
</Code>

#### –í—ñ–¥–ø–æ–≤—ñ–¥—å

<Code language="json" title="{">
{`"message": {
    "id": "msg_100003",
    "content": "–ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü–µ–π –æ–Ω–æ–≤–ª–µ–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç",
    "edited": true,
    "editedAt": "2025-10-16T12:39:00Z"
  }
}`}
</Code>

### `DELETE /api/messages/{id}`

–í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–º'—è–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è, —Ç—ñ–ª—å–∫–∏ –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–æ–º –∞–±–æ –∞–¥–º—ñ–Ω–æ–º).

#### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±–æ–≤'—è–∑–∫–æ–≤–∏–π | –û–ø–∏—Å |
|-----------|-----|--------------|------|
| `hard` | boolean | –ù—ñ | –ñ–æ—Ä—Å—Ç–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: false) |

#### –ü—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Ç—É

<Code language="bash" title="curl -X DELETE "http://localhost:3000/api/messages/msg_100003" \">
{`-H "Authorization: Bearer your-session-token"`}
</Code>

#### –í—ñ–¥–ø–æ–≤—ñ–¥—å

<Code language="json" title="{">
{`"deleted": true,
  "messageId": "msg_100003",
  "deletedBy": "user_123",
  "deletedAt": "2025-10-16T12:40:00Z"
}`}
</Code>

### `POST /api/conversations/{id}/typing`

–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä—É —Ç–µ–∫—Å—Ç—É —É—á–∞—Å–Ω–∏–∫–∞–º —Ä–æ–∑–º–æ–≤–∏.

#### –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É

<Code language="json" title="{">
{`"isTyping": true
}`}
</Code>

#### –í—ñ–¥–ø–æ–≤—ñ–¥—å

<Code language="json" title="{">
{`"sent": true,
  "expiresAt": "2025-10-16T12:40:05Z"
}`}
</Code>

### `PUT /api/messages/{id}/read`

–ü–æ–∑–Ω–∞—á–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —è–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ —É —Ä–æ–∑–º–æ–≤—ñ.

#### –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É

<Code language="json" title="{">
{`"messageIds": ["msg_100001", "msg_100002"]
}`}
</Code>

#### –í—ñ–¥–ø–æ–≤—ñ–¥—å

<Code language="json" title="{">
{`"markedRead": 2,
  "readAt": "2025-10-16T12:41:00Z"
}`}
</Code>

## üîÑ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É —Ä–µ–∂–∏–º—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É

### –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è WebSocket

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ Ring –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **Tunnel Transport** –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É —Ä–µ–∂–∏–º—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É:

// –ö–ª—ñ—î–Ω—Ç—Å—å–∫–µ WebSocket –∑'—î–¥–Ω–∞–Ω–Ω—è

<Code language="typescript" title="TypeScript">
{`import { io } from 'socket.io-client'

const socket = io('/messaging', {
  auth: {
    token: sessionToken
  }
})

// –ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏ —Ä–æ–∑–º–æ–≤–∏
socket.emit('join-conversation', conversationId)

// –ü—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
socket.on('message', (message) => {
  console.log('–ù–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', message)
  addMessageToUI(message)
})

// –ü—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä—ñ–≤ –Ω–∞–±–æ—Ä—É
socket.on('typing', (data) => {
  if (data.userId !== currentUserId) {
    showTypingIndicator(data.userId, data.isTyping)
  }
})

// –ü—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è –∫–≤–∏—Ç–∞–Ω—Ü—ñ–π –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—è
socket.on('read-receipt', (data) => {
  updateReadStatus(data.messageIds, data.userId)
})

// –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ WebSocket
socket.emit('send-message', {
  conversationId,
  content: messageText,
  type: 'text'
})`}
</Code>

### –§–æ–ª–±–µ–∫ Server-Sent Events (SSE)

–î–ª—è —Å–µ—Ä–µ–¥–æ–≤–∏—â –±–µ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ WebSocket:

// SSE –∑'—î–¥–Ω–∞–Ω–Ω—è –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

<Code language="typescript" title="TypeScript">
{`const eventSource = new EventSource('/api/messaging/stream')

eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data)

  switch (data.type) {
    case 'message':
      handleNewMessage(data.message)
      break
    case 'typing':
      handleTypingIndicator(data)
      break
    case 'read-receipt':
      handleReadReceipt(data)
      break
  }
}

// –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ HTTP, –∫–æ–ª–∏ WebSocket –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π
const sendMessage = async (conversationId: string, content: string) => {
  const response = await fetch(`/api/conversations/${conversationId}/messages`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ content, type: 'text' })
  })

  const result = await response.json()
  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É –ø—Ä–∏–π–¥–µ —á–µ—Ä–µ–∑ SSE
  return result
}`}
</Code>

## üìé –í–∫–ª–∞–¥–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

### –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ç–∏–ø–∏ —Ñ–∞–π–ª—ñ–≤

| –ö–∞—Ç–µ–≥–æ—Ä—ñ—è | –¢–∏–ø–∏ | –ú–∞–∫—Å —Ä–æ–∑–º—ñ—Ä | –§—É–Ω–∫—Ü—ñ—ó |
|-----------|------|-------------|---------|
| **–î–æ–∫—É–º–µ–Ω—Ç–∏** | PDF, DOC, DOCX, TXT, MD | 10MB | –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è |
| **–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è** | JPG, PNG, GIF, WebP, SVG | 5MB | –ú—ñ–Ω—ñ–∞—Ç—é—Ä–∞, –≤–±—É–¥–æ–≤–∞–Ω–∏–π –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ |
| **–í—ñ–¥–µ–æ** | MP4, WebM, MOV | 50MB | –í—ñ–¥–µ–æ–ø–ª–µ—î—Ä, –º—ñ–Ω—ñ–∞—Ç—é—Ä–∞ |
| **–ê—É–¥—ñ–æ** | MP3, WAV, M4A | 20MB | –ê—É–¥—ñ–æ–ø–ª–µ—î—Ä |
| **–ê—Ä—Ö—ñ–≤–∏** | ZIP, RAR, 7Z | 100MB | –¢—ñ–ª—å–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è |

### –ü—Ä–æ—Ü–µ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

// –ö–ª—ñ—î–Ω—Ç—Å—å–∫–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

<Code language="typescript" title="TypeScript">
{`const uploadFile = async (file: File): Promise<Attachment> => {
  // 1. –û—Ç—Ä–∏–º–∞—Ç–∏ URL –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
  const { uploadUrl, attachment } = await fetch('/api/upload', {
    method: 'POST',
    body: JSON.stringify({
      filename: file.name,
      contentType: file.type,
      size: file.size
    })
  }).then(r => r.json())

  // 2. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ CDN
  await fetch(uploadUrl, {
    method: 'PUT',
    body: file,
    headers: {
      'Content-Type': file.type
    }
  })

  return attachment
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ
const handleSendMessage = async (content: string, files: File[]) => {
  const attachments = await Promise.all(files.map(uploadFile))

  await fetch(`/api/conversations/${conversationId}/messages`, {
    method: 'POST',
    body: JSON.stringify({
      content,
      type: 'text',
      attachments
    })
  })
}`}
</Code>

## üí¨ –¢–∏–ø–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

### –¢–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –±–∞–≥–∞—Ç–∏—Ö —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω—å.

<Code language="json" title="{">
{`"type": "text",
  "content": "–ü—Ä–∏–≤—ñ—Ç @john, —á–∏ –º–æ–∂–µ—à —Ç–∏ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ [–≤–∏–º–æ–≥–∏](https://docs.example.com) –¥–æ–∫—É–º–µ–Ω—Ç?",
  "metadata": {
    "mentions": ["user_456"],
    "links": ["https://docs.example.com"],
    "formatting": "markdown"
  }
}`}
</Code>

### –í–∫–ª–∞–¥–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —â–æ –º—ñ—Å—Ç—è—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤.

<Code language="json" title="{">
{`"type": "file",
  "content": "–û—Å—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π —Ñ–∞–π–ª –¥–∏–∑–∞–π–Ω—É",
  "attachments": [
    {
      "id": "att_123457",
      "name": "design.fig",
      "type": "application/figma",
      "size": 15728640,
      "url": "https://cdn.example.com/files/design.fig"
    }
  ]
}`}
</Code>

### –°–∏—Å—Ç–µ–º–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –ø–æ–¥—ñ–π —Ä–æ–∑–º–æ–≤–∏.

<Code language="json" title="{">
{`"type": "system",
  "content": "john.doe –ø—Ä–∏—î–¥–Ω–∞–≤—Å—è –¥–æ —Ä–æ–∑–º–æ–≤–∏",
  "metadata": {
    "event": "participant_joined",
    "participantId": "user_456",
    "participantName": "John Doe"
  }
}`}
</Code>

### –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è-–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –Ω–∞ —ñ–Ω—à—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

<Code language="json" title="{">
{`"type": "text",
  "content": "–Ø –∑–≥–æ–¥–µ–Ω –∑ —Ü–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º",
  "replyTo": "msg_100001",
  "metadata": {
    "replyPreview": "–ó–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –≤–∏–≥–ª—è–¥–∞—î –¥–æ–±—Ä–µ..."
  }
}`}
</Code>

## üîß –ü—Ä–∏–∫–ª–∞–¥–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

// components/MessagingInterface.tsx

<Code language="typescript" title="TypeScript">
{`import { useState, useEffect, useRef } from 'react'
import { io, Socket } from 'socket.io-client'

interface Message {
  id: string
  content: string
  senderId: string
  timestamp: string
  type: string
  attachments?: Attachment[]
}

export function MessagingInterface({ conversationId }: { conversationId: string }) {
  const [messages, setMessages] = useState<Message[]>([])
  const [newMessage, setNewMessage] = useState('')
  const [socket, setSocket] = useState<Socket | null>(null)
  const messagesEndRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    // –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ä–æ–∑–º–æ–≤–∏
    fetchMessages()

    // –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ WebSocket –∑'—î–¥–Ω–∞–Ω–Ω—è
    const newSocket = io('/messaging')
    setSocket(newSocket)

    newSocket.emit('join-conversation', conversationId)

    newSocket.on('message', (message: Message) => {
      setMessages(prev => [...prev, message])
      scrollToBottom()
    })

    newSocket.on('typing', handleTyping)
    newSocket.on('read-receipt', handleReadReceipt)

    return () => {
      newSocket.disconnect()
    }
  }, [conversationId])

  const fetchMessages = async () => {
    try {
      const response = await fetch(`/api/conversations/${conversationId}/messages`)
      const data = await response.json()
      setMessages(data.messages)
      scrollToBottom()
    } catch (error) {
      console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', error)
    }
  }

  const sendMessage = async () => {
    if (!newMessage.trim()) return

    try {
      if (socket) {
        // –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —á–µ—Ä–µ–∑ WebSocket –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É
        socket.emit('send-message', {
          conversationId,
          content: newMessage,
          type: 'text'
        })
      } else {
        // –§–æ–ª–±–µ–∫ –¥–æ HTTP
        await fetch(`/api/conversations/${conversationId}/messages`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content: newMessage, type: 'text' })
        })
      }

      setNewMessage('')
    } catch (error) {
      console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', error)
    }
  }

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })
  }

  return (
    <div className="messaging-interface">
      <div className="messages-container">
        {messages.map(message => (
          <MessageBubble key={message.id} message={message} />
        ))}
        <div ref={messagesEndRef} />
      </div>

      <div className="message-input">
        <input
          value={newMessage}
          onChange={(e) => setNewMessage(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
          placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."
        />
        <button onClick={sendMessage}>–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
      </div>
    </div>
  )
}`}
</Code>

## üö® –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

### –ü–æ—à–∏—Ä–µ–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

// –†–æ–∑–º–æ–≤–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞

<Code language="json" title="configuration">
{`{
  "error": "NotFoundError",
  "message": "–†–æ–∑–º–æ–≤—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ",
  "conversationId": "conv_123456",
  "statusCode": 404
}

// –í—ñ–¥–º–æ–≤–∞ —É –¥–æ—Å—Ç—É–ø—ñ
{
  "error": "ForbiddenError",
  "message": "–í–∏ –Ω–µ —î —É—á–∞—Å–Ω–∏–∫–æ–º —Ü—ñ—î—ó —Ä–æ–∑–º–æ–≤–∏",
  "statusCode": 403
}

// –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞–Ω–∞–¥—Ç–æ –¥–æ–≤–≥–µ
{
  "error": "ValidationError",
  "message": "–í–º—ñ—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–≤–∏—â—É—î –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –¥–æ–≤–∂–∏–Ω—É 10000 —Å–∏–º–≤–æ–ª—ñ–≤",
  "maxLength": 10000,
  "statusCode": 400
}

// –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
{
  "error": "UploadError",
  "message": "–†–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É –ø–µ—Ä–µ–≤–∏—â—É—î –ª—ñ–º—ñ—Ç 10MB",
  "maxSize": "10MB",
  "statusCode": 413
}`}
</Code>

## üîí –ó–∞—Ö–æ–¥–∏ –±–µ–∑–ø–µ–∫–∏

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- –£—Å—ñ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤–∏–º–∞–≥–∞—é—Ç—å –¥—ñ–π—Å–Ω–æ—ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Å–µ—Å—ñ—ó
- WebSocket –∑'—î–¥–Ω–∞–Ω–Ω—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—é—Ç—å—Å—è –∑ —Ç–æ–∫–µ–Ω–∞–º–∏ —Å–µ—Å—ñ–π
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –≤–∏–º–∞–≥–∞—é—Ç—å –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ

### –û–±–º–µ–∂–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
- –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: 30 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å/—Ö–≤–∏–ª–∏–Ω—É –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤: 10 —Ñ–∞–π–ª—ñ–≤/–≥–æ–¥–∏–Ω—É –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- WebSocket –∑'—î–¥–Ω–∞–Ω–Ω—è: 5 –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –∑'—î–¥–Ω–∞–Ω—å –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### –ë–µ–∑–ø–µ–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç—É
- –í–º—ñ—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Å–∞–Ω—ñ—Ç—ñ–∑—É—î—Ç—å—Å—è –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è XSS –∞—Ç–∞–∫–∞–º
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ —Å–∫–∞–Ω—É—î—Ç—å—Å—è –Ω–∞ –≤—ñ—Ä—É—Å–∏ —Ç–∞ —à–∫—ñ–¥–ª–∏–≤–µ –ü–ó
- URL —É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è—Ö –≤–∞–ª—ñ–¥—É—é—Ç—å—Å—è —Ç–∞ –º–æ–∂—É—Ç—å –±–ª–æ–∫—É–≤–∞—Ç–∏—Å—è

### –ö–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å
- –ù–∞ –≤–∏–±—ñ—Ä end-to-end —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–∏—Ö —Ä–æ–∑–º–æ–≤
- –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤–∏–¥–∞–ª—è—î –≤–º—ñ—Å—Ç –≤—ñ–¥ —É—Å—ñ—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤
- –ö–≤–∏—Ç–∞–Ω—Ü—ñ—ó –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—è –º–æ–∂—É—Ç—å –≤—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è –Ω–∞ —Ä–æ–∑–º–æ–≤—É

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

// –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–æ–¥—ñ–π –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

<Code language="typescript" title="TypeScript">
{`import { trackEvent } from '@/lib/analytics'

socket.on('message', (message) => {
  trackEvent('message_sent', {
    conversationType: message.conversationType,
    messageType: message.type,
    hasAttachments: message.attachments?.length > 0,
    deliveryMethod: 'websocket'
  })
})

// –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —á–∞—Å—É –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
const sendTime = Date.now()

socket.emit('send-message', messageData, (ack) => {
  const deliveryTime = Date.now() - sendTime
  trackEvent('message_delivery_time', {
    deliveryTime,
    transport: 'websocket'
  })
})`}
</Code>

## üéõÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è WebSocket –°—Ö–æ–≤–∏—â–µ —Ñ–∞–π–ª—ñ–≤ Redis (–¥–ª—è pub/sub)

<Code language="bash" title="terminal">
{`MESSAGING_RATE_LIMIT=30
MESSAGING_FILE_SIZE_LIMIT=10485760
MESSAGING_RETENTION_DAYS=365

WS_HEARTBEAT_INTERVAL=30000
WS_CONNECTION_TIMEOUT=10000

FILE_STORAGE_PROVIDER=cloudflare_r2
FILE_STORAGE_BUCKET=messaging-files
FILE_CDN_URL=https://cdn.ring-platform.org

REDIS_URL=redis://localhost:6379`}
</Code>

### –°—Ö–µ–º–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

<Code language="sql" title="-- –¢–∞–±–ª–∏—Ü—è —Ä–æ–∑–º–æ–≤">
{`CREATE TABLE conversations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  type VARCHAR(20) NOT NULL, -- direct, group, channel
  title VARCHAR(255),
  description TEXT,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  settings JSONB DEFAULT '{}'
);

-- –£—á–∞—Å–Ω–∏–∫–∏ —Ä–æ–∑–º–æ–≤
CREATE TABLE conversation_participants (
  conversation_id UUID REFERENCES conversations(id),
  user_id UUID REFERENCES users(id),
  role VARCHAR(20) DEFAULT 'member', -- admin, member
  joined_at TIMESTAMP DEFAULT NOW(),
  last_seen_at TIMESTAMP,
  settings JSONB DEFAULT '{}',
  PRIMARY KEY (conversation_id, user_id)
);

-- –¢–∞–±–ª–∏—Ü—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
CREATE TABLE messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  conversation_id UUID REFERENCES conversations(id),
  sender_id UUID REFERENCES users(id),
  content TEXT,
  type VARCHAR(20) DEFAULT 'text',
  metadata JSONB DEFAULT '{}',
  reply_to UUID REFERENCES messages(id),
  edited BOOLEAN DEFAULT FALSE,
  edited_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- –°—Ç–∞—Ç—É—Å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
CREATE TABLE message_reads (
  message_id UUID REFERENCES messages(id),
  user_id UUID REFERENCES users(id),
  read_at TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY (message_id, user_id)
);`}
</Code>

---

*–°–∏—Å—Ç–µ–º–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ Ring –∑–∞–±–µ–∑–ø–µ—á—É—î –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—é –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è —É —Ä–µ–∂–∏–º—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É –∑ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∏–º –æ–±–º—ñ–Ω–æ–º —Ñ–∞–π–ª–∞–º–∏, –∫—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–Ω–æ—é —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—é —Ç–∞ —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ.*