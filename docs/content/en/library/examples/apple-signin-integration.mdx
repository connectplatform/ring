---
title: Apple Sign-in Integration
description: Complete guide to implementing Sign in with Apple in Ring Platform
---

# Apple Sign-in Integration Guide

This guide provides a complete walkthrough for integrating **Sign in with Apple** into your Ring Platform application.

## Prerequisites Checklist

- ✅ Apple Developer Account ($99/year)
- ✅ App ID registered with Sign in with Apple capability
- ✅ Service ID configured for web authentication
- ✅ Private key (.p8 file) downloaded and secured
- ✅ Team ID from Apple Developer account

## Quick Setup (5 minutes)

If you already have your Apple credentials, here's the fastest way to get Apple Sign-in working:

### 1. Environment Variables

Add to your `.env.local`:

<Code language="bash" title="AUTH_APPLE_ID=com.sonoratek.ring-auth">
{`AUTH_APPLE_SECRET=<your-jwt-token-here>`}
</Code>

### 2. Generate JWT Token

Run our helper script:

<Code language="bash" title="terminal">
{`cd scripts
node generate-apple-jwt.js`}
</Code>

Or manually generate with Node.js:

<Code language="javascript" title="import jwt from 'jsonwebtoken';">
{`import fs from 'fs';

const token = jwt.sign(
  {
    iss: 'X9EQDPCJU6', // Your Team ID
    iat: Math.floor(Date.now() / 1000),
    exp: Math.floor(Date.now() / 1000) + 15777000,
    aud: 'https://appleid.apple.com',
    sub: 'com.sonoratek.ring-auth',
  },
  fs.readFileSync('AuthKey_YD444LWM9J.p8'),
  { algorithm: 'ES256', keyid: 'YD444LWM9J' }
);`}
</Code>

### 3. Add to Your Login Component

<Code language="typescript" title="'use client'">
{`import { signIn } from 'next-auth/react'
import { AppleIcon } from '@/components/icons'

export function LoginForm() {
  return (
    <div className="space-y-4">
      <button
        onClick={() => signIn('apple')}
        className="w-full flex items-center justify-center gap-2 bg-black text-white py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors"
      >
        <AppleIcon className="w-5 h-5" />
        Continue with Apple
      </button>
    </div>
  )
}`}
</Code>

That's it! Apple Sign-in is now active in your application.

## Complete Implementation Example

Here's a full example of Apple Sign-in integrated into a login component:

// components/auth/AppleSignInButton.tsx

<Code language="typescript" title="TypeScript">
{`'use client'

import { signIn, getSession } from 'next-auth/react'
import { useState } from 'react'
import { AppleIcon } from '@/components/icons'

interface AppleSignInButtonProps {
  className?: string
  size?: 'sm' | 'md' | 'lg'
  variant?: 'primary' | 'secondary'
}

export function AppleSignInButton({
  className = '',
  size = 'md',
  variant = 'primary'
}: AppleSignInButtonProps) {
  const [isLoading, setIsLoading] = useState(false)

  const handleAppleSignIn = async () => {
    try {
      setIsLoading(true)

      const result = await signIn('apple', {
        callbackUrl: '/dashboard',
        redirect: false
      })

      if (result?.error) {
        console.error('Apple sign-in error:', result.error)
        // Handle error (show toast, etc.)
      } else if (result?.url) {
        window.location.href = result.url
      }
    } catch (error) {
      console.error('Apple sign-in failed:', error)
    } finally {
      setIsLoading(false)
    }
  }

  const sizeClasses = {
    sm: 'py-2 px-3 text-sm',
    md: 'py-3 px-4 text-base',
    lg: 'py-4 px-6 text-lg'
  }

  const variantClasses = {
    primary: 'bg-black text-white hover:bg-gray-800 border-black',
    secondary: 'bg-white text-black border-gray-300 hover:bg-gray-50'
  }

  return (
    <button
      onClick={handleAppleSignIn}
      disabled={isLoading}
      className={`
        w-full flex items-center justify-center gap-3 border rounded-lg
        transition-all duration-200 font-medium
        disabled:opacity-50 disabled:cursor-not-allowed
        ${sizeClasses[size]}
        ${variantClasses[variant]}
        ${className}
      `}
    >
      {isLoading ? (
        <div className="w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin" />
      ) : (
        <AppleIcon className="w-5 h-5" />
      )}
      {isLoading ? 'Signing in...' : 'Continue with Apple'}
    </button>
  )
}`}
</Code>

## Integration with Existing Login Flow

Here's how to integrate Apple Sign-in with your existing authentication UI:

// components/auth/SocialLoginSection.tsx

<Code language="typescript" title="TypeScript">
{`'use client'

import { signIn } from 'next-auth/react'
import { AppleIcon, GoogleIcon } from '@/components/icons'

export function SocialLoginSection() {
  const handleProviderSignIn = async (provider: 'google' | 'apple') => {
    try {
      await signIn(provider, {
        callbackUrl: '/onboarding',
        redirect: true
      })
    } catch (error) {
      console.error(`${provider} sign-in error:`, error)
    }
  }

  return (
    <div className="space-y-4">
      <div className="relative">
        <div className="absolute inset-0 flex items-center">
          <div className="w-full border-t border-gray-300" />
        </div>
        <div className="relative flex justify-center text-sm">
          <span className="px-2 bg-white text-gray-500">Or continue with</span>
        </div>
      </div>

      <div className="grid grid-cols-2 gap-3">
        <button
          onClick={() => handleProviderSignIn('google')}
          className="flex items-center justify-center gap-2 py-2.5 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
        >
          <GoogleIcon className="w-5 h-5" />
          <span className="text-sm font-medium">Google</span>
        </button>

        <button
          onClick={() => handleProviderSignIn('apple')}
          className="flex items-center justify-center gap-2 py-2.5 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
        >
          <AppleIcon className="w-5 h-5" />
          <span className="text-sm font-medium">Apple</span>
        </button>
      </div>
    </div>
  )
}`}
</Code>

## Handling Apple Sign-in Callbacks

// app/auth/callback/apple/page.tsx

<Code language="typescript" title="TypeScript">
{`'use client'

import { useEffect, useState } from 'react'
import { useSession } from 'next-auth/react'
import { useRouter } from 'next/navigation'

export default function AppleCallback() {
  const { data: session, status } = useSession()
  const router = useRouter()
  const [error, setError] = useState<string | null>(null)

  useEffect(() => {
    if (status === 'loading') return

    if (session?.user) {
      // Successful sign-in
      router.push('/dashboard')
    } else {
      // Check for error in URL params
      const urlParams = new URLSearchParams(window.location.search)
      const errorParam = urlParams.get('error')

      if (errorParam) {
        setError(`Authentication failed: ${errorParam}`)
      }
    }
  }, [session, status, router])

  if (status === 'loading') {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-black mx-auto"></div>
          <p className="mt-4 text-gray-600">Completing sign-in...</p>
        </div>
      </div>
    )
  }

  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="text-red-600 mb-4">⚠️ {error}</div>
          <button
            onClick={() => router.push('/login')}
            className="px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800"
          >
            Try Again
          </button>
        </div>
      </div>
    )
  }

  return null
}`}
</Code>

## Customizing Apple Sign-in Experience

### Styling Options

// Custom styled Apple button

<Code language="typescript" title="TypeScript">
{`export function CustomAppleButton() {
  return (
    <button
      onClick={() => signIn('apple')}
      className="group relative w-full flex items-center justify-center py-3 px-4 border border-gray-300 rounded-lg hover:border-gray-400 transition-colors"
    >
      <div className="absolute left-4">
        <svg className="w-5 h-5" viewBox="0 0 24 24">
          <path
            fill="currentColor"
            d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"
          />
        </svg>
      </div>
      <span className="text-gray-700 font-medium">Sign in with Apple</span>
    </button>
  )
}`}
</Code>

## Testing Apple Sign-in

### Development Testing

1. **Use TestFlight**: Apple provides TestFlight for testing Sign in with Apple
2. **Sandbox Environment**: Apple provides sandbox accounts for testing
3. **Development Certificates**: Use development certificates for testing

### Production Testing

1. **App Store Review**: Apple reviews Sign in with Apple implementation
2. **Privacy Policy**: Ensure your privacy policy mentions Sign in with Apple
3. **User Consent**: Verify users understand what data Apple shares

## Troubleshooting Common Issues

### "Invalid Client" Error

// Check your environment variables

<Code language="typescript" title="TypeScript">
{`console.log('APPLE_ID:', process.env.AUTH_APPLE_ID)
console.log('APPLE_SECRET length:', process.env.AUTH_APPLE_SECRET?.length)

// Verify Service ID matches
const expectedServiceId = 'com.sonoratek.ring-auth'
const actualServiceId = process.env.AUTH_APPLE_ID

if (actualServiceId !== expectedServiceId) {
  console.error('Service ID mismatch!')
}`}
</Code>

### JWT Token Issues

// Validate JWT structure

<Code language="typescript" title="TypeScript">
{`import jwt from 'jsonwebtoken'

function validateAppleJWT(token: string) {
  try {
    const decoded = jwt.decode(token, { complete: true })
    console.log('JWT Header:', decoded?.header)
    console.log('JWT Payload:', decoded?.payload)

    // Check expiration
    const exp = decoded?.payload?.exp
    if (exp && exp < Date.now() / 1000) {
      console.error('JWT token expired!')
    }
  } catch (error) {
    console.error('Invalid JWT:', error)
  }
}`}
</Code>

### Domain Verification

Ensure your domain is properly configured in Apple Developer Portal:

1. Go to your Service ID configuration
2. Add your domain to "Domains and Subdomains"
3. Add return URLs for your application
4. Verify domain ownership with Apple's verification file

## Performance Optimization

### Caching Strategies

<Code language="typescript" title="TypeScript">
{`// Cache JWT tokens (regenerate every 5 months instead of 6)
const JWT_CACHE_DURATION = 5 * 30 * 24 * 60 * 60 * 1000 // 5 months

export function getCachedAppleJWT() {
  const cached = localStorage.getItem('apple-jwt')
  const cacheTime = localStorage.getItem('apple-jwt-time')

  if (cached && cacheTime) {
    const age = Date.now() - parseInt(cacheTime)
    if (age < JWT_CACHE_DURATION) {
      return cached
    }
  }

  // Generate new token
  const newToken = generateAppleJWT()
  localStorage.setItem('apple-jwt', newToken)
  localStorage.setItem('apple-jwt-time', Date.now().toString())

  return newToken
}`}
</Code>

## Security Best Practices

1. **Key Rotation**: Rotate private keys regularly
2. **Environment Isolation**: Use different keys for dev/staging/production
3. **Audit Logging**: Log all authentication attempts
4. **Rate Limiting**: Implement rate limiting on sign-in endpoints
5. **Token Validation**: Always validate tokens server-side

## Migration from Other Providers

If migrating from Google-only authentication:

<Code language="typescript" title="TypeScript">
{`// Before (Google only)
<button onClick={() => signIn('google')}>
  Sign in with Google
</button>

// After (Multi-provider)
<div className="space-y-2">
  <button onClick={() => signIn('google')}>
    Sign in with Google
  </button>
  <button onClick={() => signIn('apple')}>
    Sign in with Apple
  </button>
</div>`}
</Code>

This implementation provides a seamless, secure, and user-friendly Apple Sign-in experience for your Ring Platform users.
